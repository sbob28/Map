<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wings Across the World: Why Birds Migrate</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <link href="https://fonts.googleapis.com/css2?family=Actor&family=Signika+Negative:wght@400;600&family=Sigmar+One&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Actor", sans-serif;
      margin: 0;
      background-color: #fafafa;
      text-align: center;
      padding: 10px; 
    }

    .page-container {
      max-width: 1200px;
      margin: auto;
      background: #ffffff;
      padding: 30px;

      border: 30px solid #004d40; 
      border-radius: 20px; 
    }

    h2 {
      font-family: "Sigmar One", cursive;
      color: #004d40;
      margin-bottom: 0.3em;
      font-size: 3.5rem;
    }
    h3 {
      font-family: "Signika Negative", sans-serif;
      margin-top: 2em;
      font-size: 2rem;
      color: #00695c;
    }
    h4 {
      font-family: "Signika Negative", sans-serif;
      color: #004d40;
      margin-bottom: 0.5em;
    }
    p {
      max-width: 850px;
      margin: 0.5em auto;
      line-height: 1.6;
      font-size: 1.2rem;
      color: #333;
    }

    #bird {
      width: 200px;
      animation: flyIn 5s ease-in forwards, flap 5s ease-in 10s infinite;
      transform-origin: center top;
    }
    @keyframes flyIn {
      0% { transform: translateX(-200px) translateY(-60px) rotate(-20deg); opacity:0; }
    }
    @keyframes flap {
      0%,100% {transform:translateY(0) rotate(0deg) scaleY(1);}
    }

    .chart { margin: 40px auto; }

    .flowmap-wrapper {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 0px;
      margin-top: 0px;
      flex-wrap: wrap;
    }

    #flowmap { flex: 1 1 850px; height: 550px; }
    #flowmap-controls {
      width: 230px;
      text-align: left;
      background: transparent;
    }

    select {
      width: 100%;
      padding: 1px;
      border-radius: 10px;
      border: 1px solid #aaa;
      font-family: "Actor";
      background: white;
    }

    #flowmap-legend div {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      cursor: pointer;
    }
    #flowmap-legend span {
      width: 14px;
      height: 14px;
      display: inline-block;
      border-radius: 3px;
      margin-right: 8px;
    }

    footer {
      margin-top: 4em;
      font-size: 0.9rem;
      color: #555;
    }

    @media(max-width:900px){
      .flowmap-wrapper { flex-direction: column; align-items: center; }
      #flowmap-controls { width: 90%; text-align: center; }
    }
  </style>
</head>
<body>

  <div class="page-container">

    <h2>
      Wings Across the World: Why Birds Migrate
      <br>
      <img src="bird_flying.gif" id="bird" alt="bird" />
    </h2>

    <p>
      Birds migrate for powerful reasons — to breed, to feed, to escape danger, or to follow the shifting seasons.  
      Each reason drives a different kind of journey, shaping how far, how long, and with whom these creatures travel.  
      This visual story explores how the <strong>motives behind migration</strong> influence the patterns we see in the skies.
    </p>

    <h3>Global Migration Routes</h3>
    <p>
      Migration begins with purpose.  
      The flow map below traces long-distance journeys lasting over 70 hours, showing how migration reasons affect routes across the globe.  
      Choose a reason to uncover how motivations — like breeding or escaping predators — influence each species’ path.
    </p>

    <div class="flowmap-wrapper">
      <div id="flowmap" class="chart"></div>
      <div id="flowmap-controls">
        <h4>Filter by Migration Reason</h4>
        <div id="reason-toggle"></div>
        <p style="margin-top:1em;"><strong>Species Legend:</strong></p>
        <div id="flowmap-legend"></div>
      </div>
    </div>

    <h3>How Distance Varies by Reason</h3>
    <p>
      Not all journeys are equal.  
      Some migration reasons demand long intercontinental flights, while others involve shorter regional movements.  
      The box plot compares flight distances for each species — revealing how purpose shapes endurance and travel range.
    </p>
    <div id="boxplot" class="chart"></div>

    <h3>Time in the Air</h3>
    <p>
      The length of each flight tells us how demanding migration can be.  
      This scatter plot explores how flight duration relates to distance for different species — filtered by migration reason.  
      It highlights how motivations like breeding or feeding lead to distinct flight efficiencies and strategies.
    </p>
    <div id="scatter" class="chart"></div>

    <h3>Travelling Together</h3>
    <p>
      Some reasons for migration encourage flocking — protection, cooperation, and shared routes.  
      The histogram below shows how flock sizes change depending on the migration reason, 
      uncovering patterns of social behaviour during successful journeys.
    </p>
    <div id="histogram" class="chart"></div>

    <footer>
      <strong>Data source:</strong> https://www.kaggle.com/datasets/sahirmaharajj/bird-migration-dataset-data-visualization-eda |
      <strong>Story & Visualisation:</strong> Srividya Bobba |
      <strong>Projection:</strong> Equal Earth
    </footer>

  </div>

  <script>
    let flowmapView, boxplotView, scatterView, histogramView;

    // Dropdown for migration reasons
    const reasons = ["All Reasons", "Breeding", "Avoid Predators", "Climate Change", "Feeding"];
    const dropdown = document.createElement("select");
    reasons.forEach(r => {
      const option = document.createElement("option");
      option.value = r === "All Reasons" ? "" : r;
      option.textContent = r;
      dropdown.appendChild(option);
    });
    document.getElementById("reason-toggle").appendChild(dropdown);

    dropdown.addEventListener("change", e => {
      const val = e.target.value || null;
      if(flowmapView) flowmapView.signal("reasonFilter", val).run();
      if(boxplotView) boxplotView.signal("reasonFilter", val).run();
      if(scatterView) scatterView.signal("reasonFilter", val).run();
      if(histogramView) histogramView.signal("reasonFilter", val).run();
    });

    // Flow map
    vegaEmbed("#flowmap", "flowmap.json", {renderer: "canvas"}).then(result => {
      flowmapView = result.view;
      const species = ["Warbler", "Eagle", "Stork", "Hawk", "Crane", "Goose", "Swallow"];
      const colorScale = ["#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3", "#a6d854", "#ffd92f", "#e5c494"];
      let selectedSpecies = null;
      const legendDiv = document.getElementById("flowmap-legend");

      species.forEach((s,i) => {
        const item = document.createElement("div");
        item.innerHTML = `<span style="background-color:${colorScale[i]}"></span>${s}`;
        item.addEventListener("click", () => {
          if(selectedSpecies === s){
            selectedSpecies = null;
            flowmapView.signal("speciesFilter", null).run();
          } else {
            selectedSpecies = s;
            flowmapView.signal("speciesFilter", s).run();
          }
        });
        legendDiv.appendChild(item);
      });
    });

    vegaEmbed("#boxplot", "boxplot.json", {renderer: "canvas"}).then(result => { boxplotView = result.view; });
    vegaEmbed("#scatter", "scatter.json", {renderer: "canvas"}).then(result => { scatterView = result.view; });
    vegaEmbed("#histogram", "stacked_histogram.json", {renderer: "canvas"}).then(result => { histogramView = result.view; });
  </script>
</body>
</html>
